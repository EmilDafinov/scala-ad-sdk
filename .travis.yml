language: scala
cache:
  directories:
    - "$HOME/.ivy2/cache"
    - "$HOME/.sbt/boot/"
jobs:
  include:

    - stage: test
      env:
        - NAME="Assert project version is not overriden manually"
      scala: 2.12.2
      jdk: oraclejdk8
      script:
        - sbt dynverAssertVersion

    - stage: test
      env:
        - NAME="Run unit tests"
      scala: 2.12.2
      jdk: oraclejdk8
      script: 
        - sbt ++$TRAVIS_SCALA_VERSION clean coverage test
        - sbt coverageReport coverageAggregate codacyCoverage
        
    - stage: test
      env:
        - NAME="Run integration tests"
      scala: 2.12.2
      jdk: oraclejdk8
      script: 
        - sbt ++$TRAVIS_SCALA_VERSION clean it:test
        
    - stage: publish build artifacts
      scala: 2.12.2
      jdk: oraclejdk8
      script: 
        # Write the bintray credentials to disk (sbt-bintray expects them to be present there in order to run)
        - curl -O https://gist.githubusercontent.com/EmilDafinov/c874e7f3abe77dd770c2bd26828b9224/raw/f75b659d1a2c3634140eace2c7899dc634e2790b/travis_bintray_credentials.sh &&
          chmod +x travis_bintray_credentials.sh &&
          ./travis_bintray_credentials.sh
        - sbt ++$TRAVIS_SCALA_VERSION publish

notifications:
  email: false
